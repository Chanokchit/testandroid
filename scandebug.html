<html lang="th">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<script type="text/javascript">
    let time_scan = 10000;
    var uuid_device = '54F888C9-EFEF-68D2-B21D-A730AC675099' //'310AA789-4E84-990A-C1AB-CDA6694E4FE9'
    // var uuid_device = '46B314E5-E9DF-2D51-D524-06B718D02025' // A658ED45-BA23-BE46-5482-E1B5205D922A   54F888C9-EFEF-68D2-B21D-A730AC675099
    var uuid_device2 = 'A25692B2-5EF3-0C47-90F3-36391CA3CB53'
    var uuid_service = '180D' //FF00
    var uuid_characteristic_read = '2A38' //AA11
    var uuid_characteristic_write = '2A39' //FF01
    var data_type = 'hex'
    var data_type2 = 'text'
    var datawrite = '0006CC59513C4CAA6116D34BF71000B12EF8'
    var datawrite2 = 'test write text 2021'

    function checkuserAgent () {
        
      var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        if (/windows phone/i.test(userAgent)) {
        //   document.getElementById("data").innerHTML= "windows_phone";
                return "windows_phone";
            }
            if (/android/i.test(userAgent)) {
            //   document.getElementById("data").innerHTML= "android";
                alert ("android") 
                return "android";
            }
            if (/Macintosh|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            //   document.getElementById("data").innerHTML= "ios";
            alert ("ios")    
            return "ios";
            }
            // document.getElementById("data").innerHTML= "unknown";
            alert ("unknown") 
            return "unknown";
            }
    function scanDevice() {
        try {
            if (checkuserAgent() == 'ios') {
            webkit.messageHandlers.OneChat_scanDevice.postMessage(time_scan);
            } else if (checkuserAgent() == 'android') {
            JavaScriptInterface.OneChat_scanDevice(time_scan);
            alert('scan')
        }
        } catch(error) {
            alert('scanDevice ' + error)
        }
    }
    // function stopscanDevice() {
    //     try {
    //         // webkit.messageHandlers.OneChat_stopScanDevice.postMessage(String Any)	
    //         webkit.messageHandlers.OneChat_stopScanDevice.postMessage("Success disconnect");
    //     } catch(error) {
    //         alert('stop scanDevice' + error)
    //     }
    // }
    function disconnectBluetoothAll() {
        try {
            webkit.messageHandlers.OneChat_disconnectBluetoothAll.postMessage("Success")
        //     if (checkuserAgent() == 'ios') {
        //   webkit.messageHandlers.OneChat_disconnectBluetoothAll.postMessage('disconnect');
        // } else if (checkuserAgent() == 'android') {
        //   JavaScriptInterface.OneChat_disconnectBluetoothAll('disconnect');
        // }
        } catch(error) {
            alert('disconnectBluetoothAll ' + error)
        }
    }
    function disconnectBluetoothByUUID() {
        try {
            if (checkuserAgent() == 'ios') {
            webkit.messageHandlers.OneChat_disconnectBluetoothByUUID.postMessage(uuid_device);
            } else if (checkuserAgent() == 'android') {
            JavaScriptInterface.OneChat_disconnectBluetoothByUUID(JSON.stringify({uuid:uuid_device}));
            alert('disconnect')
        }
            // webkit.messageHandlers.OneChat_disconnectBluetoothByUUID.postMessage(String uuid)	
            // webkit.messageHandlers.OneChat_disconnectBluetoothByUUID.postMessage(uuid_device);
        } catch(error) {
            alert('disconnectBluetoothByUUID' + error)
        }
    }

    function logtoHTML(input){
    let out = input;
    if (typeof(input) == 'object') {
      try {
          out =  JSON.stringify(input, undefined, 4);
      }
      catch(e) {
          alert(e);
      }
    }

    let debugbox = document.getElementById("devicelist");
    if (debugbox) {
      debugbox.innerHTML = out + '<br>-------------------------------------------------<br>' + document.getElementById("devicelist").innerHTML;
    }
}
    
    function oneChatBluetoothCallBackData(type, data) {
        try {
            document.getElementById("type").innerHTML= type, data;
            // logtoHTML('>>>> <br>' + type + data)
            if (type == 'get_device_service') {
                let obj = JSON.parse(data);
                var message = ''
                for (let i = 0; i < obj.data.length; i++) {
                    let a = obj.data[i];

                    message += `
                        name : ${a.bluetooth_name}<br>
                        uuid : ${a.uuid}<br>
                        manufacturer_data : ${a.manufacturer_data}<br>
                        state : ${a.state}<br>
                        rssi : ${a.rssi}<br>
                        -----------------------------------------------------<br>
                    `;
                }
                document.getElementById("listdevice").innerHTML=message;

            // } else if (type == 'start_scan_bluetooth') {
            //     let obj = JSON.parse(data);
            //     var message = ''
            //         message += `
            //             status : ${obj.type}<br>
            //             message : ${obj.message}<br>
            //             -----------------------------------------------------<br>
            //         `;
            //     document.getElementById("startdevice").innerHTML=message;

            // } else if (type == 'stop_scan_bluetooth') {
            //     alert (data)
            //     let obj = JSON.parse(data);
            //     var message = ''
            //         message += `
            //             status : ${obj.type}<br>
            //             message : ${obj.message}<br>
            //             -----------------------------------------------------<br>
            //         `;
            //     document.getElementById("stopdevice").innerHTML=message;

            } else if (type == 'disconnect_bluetooth_all') {
                let obj = JSON.parse(data);
                alert(obj + type)
                var message = ''
                    message += `
                        status : ${obj.type}<br>
                        message : ${obj.message}<br>
                        -----------------------------------------------------<br>
                    `;
                document.getElementById("disconnectbluetooth").innerHTML=message;

            } else if (type == 'disconnect_bluetooth_by_uuid') {
                let obj = JSON.parse(data);
                alert(obj + type)
                var message = ''
                    message += `
                        name : ${obj.device_name}<br>
                        uuid : ${obj.device_uuid}<br>
                        message : ${obj.message}<br>
                        -----------------------------------------------------<br>
                    `;
                document.getElementById("disconnectbluetoothUUID").innerHTML=message;
            }
        }
        catch(error) {
            alert('error >>>>>>>> ' + error);
        }        
    }

</script>
<body>
    <div id="type" width=300></div>
    <h1>
        <a href="javascript:checkuserAgent();">[ checkuserAgent ]</a>
    </h1>
        <div id="checkuser" width=300></div>
    <!-- <h1>
        <a href="javascript:scanDevice();">[ start scan device ]</a>
    </h1>
        <div id="startdevice" width=300></div> -->
    <!-- <h1>
        <a href="javascript:stopscanDevice();">[ stop scan device ]</a>
    </h1>
        <div id="stopdevice" width=300></div> -->
    <h1>
        <a href="javascript:disconnectBluetoothAll();">[ disconnect all bluetooth ]</a>
    </h1>
        <div id="disconnectbluetooth" width=300></div>
    <h1>
        <a href="javascript:disconnectBluetoothByUUID();">[ disconnect bluetooth by UUID ]</a>
    </h1>
        <div id="disconnectbluetoothUUID" width=300></div>
    <h1>
        <a href="javascript:scanDevice();">[ scan device ]</a>
    </h1>
        <div id="listdevice" width=300></div>
</body>
</html>
